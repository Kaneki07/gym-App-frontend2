---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Calculadora Fitness">
  <div class="max-w-7xl mx-auto px-6 py-12">
    <header class="mb-12">
      <h1 class="text-4xl md:text-6xl font-black uppercase tracking-tighter text-white">
        Diagnóstico <span class="text-red-600">Biométrico</span>
      </h1>
      <p class="text-gray-500 font-bold uppercase tracking-widest text-sm mt-2">
        Calcula grasa corporal, masa magra y requerimientos calóricos
      </p>
    </header>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
      
      <div class="lg:col-span-5 space-y-8">
        <section class="bg-gray-900/30 border border-gray-800 p-8 rounded-[2.5rem] relative overflow-hidden">
          <div class="absolute -right-4 -top-4 text-8xl font-black text-white/[0.02] italic pointer-events-none uppercase"></div>
          
          <h2 class="text-xl font-black text-white uppercase italic mb-8 flex items-center gap-3 relative z-10">
            <span class="w-2 h-6 bg-red-600"></span> Medidas Actuales
          </h2>

          <div class="space-y-6 relative z-10">
            <div class="grid grid-cols-2 gap-4">
              <div class="space-y-2">
                <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1">Peso (kg)</label>
                <input type="number" id="peso" class="w-full bg-black border border-gray-800 rounded-xl px-4 py-4 text-white font-bold focus:border-red-600 outline-none transition-all placeholder:text-gray-800" placeholder="00">
              </div>
              <div class="space-y-2">
                <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1">Altura (cm)</label>
                <input type="number" id="altura" class="w-full bg-black border border-gray-800 rounded-xl px-4 py-4 text-white font-bold focus:border-red-600 outline-none transition-all placeholder:text-gray-800" placeholder="000">
              </div>
            </div>

            <div class="grid grid-cols-2 gap-4 border-t border-gray-800/50 pt-6">
              <div class="space-y-2">
                <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1">Cuello (cm)</label>
                <input type="number" id="cuello" class="w-full bg-black border border-gray-800 rounded-xl px-4 py-4 text-white font-bold focus:border-red-600 outline-none transition-all placeholder:text-gray-800" placeholder="00">
              </div>
              <div class="space-y-2">
                <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1">Cintura (cm)</label>
                <input type="number" id="cintura" class="w-full bg-black border border-gray-800 rounded-xl px-4 py-4 text-white font-bold focus:border-red-600 outline-none transition-all placeholder:text-gray-800" placeholder="00">
              </div>
            </div>

            <div class="space-y-2 border-t border-gray-800/50 pt-6">
              <label class="text-[10px] font-black text-gray-500 uppercase tracking-widest ml-1">Nivel de Actividad Diaria</label>
              <select id="actividad" class="w-full bg-black border border-gray-800 rounded-xl px-4 py-4 text-white font-bold focus:border-red-600 outline-none transition-all appearance-none cursor-pointer">
                <option value="1.2">Sedentario (Oficina / Sin ejercicio)</option>
                <option value="1.375">Ligero (1-3 días de entreno)</option>
                <option value="1.55">Moderado (3-5 días de entreno)</option>
                <option value="1.725">Intenso (6-7 días de entreno)</option>
              </select>
            </div>

            <button id="btn-calcular" class="w-full bg-red-600 hover:bg-red-700 text-white font-black uppercase italic py-5 rounded-2xl transition-all mt-4 tracking-tighter text-lg shadow-lg shadow-red-900/20 active:scale-[0.98]">
              Calcular Resultados
            </button>
          </div>
        </section>
      </div>

      <div class="lg:col-span-7 space-y-6">
        
        <div id="result-box" class="grid grid-cols-1 md:grid-cols-2 gap-6 opacity-20 transition-all duration-700 translate-y-4">
          <div class="bg-gray-900/40 border border-gray-800 p-8 rounded-[2rem] relative group overflow-hidden">
            <p class="text-[10px] font-black text-red-600 uppercase tracking-[0.2em] mb-2">Grasa Corporal</p>
            <div class="flex items-baseline gap-2">
              <h3 id="res-grasa" class="text-6xl font-black text-white italic">--</h3>
              <span class="text-2xl font-black text-gray-700 italic">%</span>
            </div>
            <div class="h-1 w-full bg-gray-800 mt-4 rounded-full overflow-hidden">
                <div id="bar-grasa" class="h-full bg-red-600 w-0 transition-all duration-1000"></div>
            </div>
          </div>

          <div class="bg-gray-900/40 border border-gray-800 p-8 rounded-[2rem] relative group overflow-hidden">
            <p class="text-[10px] font-black text-red-600 uppercase tracking-[0.2em] mb-2">Masa Magra</p>
            <div class="flex items-baseline gap-2">
              <h3 id="res-masa" class="text-6xl font-black text-white italic">--</h3>
              <span class="text-2xl font-black text-gray-700 italic">KG</span>
            </div>
            <p class="text-[9px] text-gray-500 font-bold uppercase mt-4 italic">Peso libre de grasa aproximado</p>
          </div>
        </div>

        <div id="nutri-box" class="bg-black border border-gray-800 rounded-[2.5rem] overflow-hidden opacity-20 transition-all duration-700 translate-y-4 delay-150">
          <div class="p-8 border-b border-gray-900">
             <h3 class="text-white font-black uppercase italic tracking-tighter flex items-center gap-2">
                <span class="w-1.5 h-4 bg-red-600"></span> Plan de Alimentación
             </h3>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2">
            <div class="p-8 border-b md:border-b-0 md:border-r border-gray-900 hover:bg-white/[0.02] transition-colors">
              <span class="bg-gray-800 text-gray-400 text-[8px] font-black px-2 py-1 rounded uppercase tracking-widest">Objetivo: Cut</span>
              <h4 id="res-def" class="text-4xl font-black text-white italic mt-4">--</h4>
              <p class="text-red-600 text-[10px] font-bold uppercase mt-2 tracking-tighter">Calorías para Definición</p>
              <div class="mt-6 space-y-2">
                <div class="flex justify-between text-[10px] font-bold uppercase"><span class="text-gray-500 text-[10px]">Proteína</span> <span class="text-white">High</span></div>
                <div class="flex justify-between text-[10px] font-bold uppercase"><span class="text-gray-500 text-[10px]">Déficit</span> <span class="text-white">-500 kcal</span></div>
              </div>
            </div>

            <div class="p-8 hover:bg-red-600/[0.02] transition-colors">
              <span class="bg-red-600 text-white text-[8px] font-black px-2 py-1 rounded uppercase tracking-widest">Objetivo: Bulk</span>
              <h4 id="res-vol" class="text-4xl font-black text-white italic mt-4">--</h4>
              <p class="text-red-600 text-[10px] font-bold uppercase mt-2 tracking-tighter">Calorías para Volumen</p>
              <div class="mt-6 space-y-2">
                <div class="flex justify-between text-[10px] font-bold uppercase"><span class="text-gray-500 text-[10px]">Carbohidratos</span> <span class="text-white">High</span></div>
                <div class="flex justify-between text-[10px] font-bold uppercase"><span class="text-gray-500 text-[10px]">Superávit</span> <span class="text-white">+500 kcal</span></div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</Layout>

<script>
  const btnCalcular = document.getElementById('btn-calcular');
  const resultBox = document.getElementById('result-box');
  const nutriBox = document.getElementById('nutri-box');

  btnCalcular?.addEventListener('click', () => {
    // Captura de valores
    const peso = parseFloat((document.getElementById('peso') as HTMLInputElement).value);
    const altura = parseFloat((document.getElementById('altura') as HTMLInputElement).value);
    const cuello = parseFloat((document.getElementById('cuello') as HTMLInputElement).value);
    const cintura = parseFloat((document.getElementById('cintura') as HTMLInputElement).value);
    const actividad = parseFloat((document.getElementById('actividad') as HTMLSelectElement).value);

    if (!peso || !altura || !cuello || !cintura) {
      alert("⚠️ Ingresa todos los datos para realizar el diagnóstico.");
      return;
    }

    // LÓGICA DE CÁLCULO
    // 1. Grasa Corporal (Marina EE.UU)
    const fatPercentage = 495 / (1.0324 - 0.19077 * Math.log10(cintura - cuello) + 0.15456 * Math.log10(altura)) - 450;
    
    // 2. Masa Magra
    const leanMass = peso * (1 - (fatPercentage / 100));

    // 3. TMB y Mantenimiento (Harris-Benedict rev)
    const tmb = (10 * peso) + (6.25 * altura) - (5 * 25) + 5; 
    const mantenimiento = tmb * actividad;

    // ACTUALIZACIÓN DE UI
    // Animación de aparición
    resultBox?.classList.remove('opacity-20', 'translate-y-4');
    nutriBox?.classList.remove('opacity-20', 'translate-y-4');

    // Inserción de datos
    const resGrasa = document.getElementById('res-grasa');
    const resMasa = document.getElementById('res-masa');
    const resDef = document.getElementById('res-def');
    const resVol = document.getElementById('res-vol');
    const barGrasa = document.getElementById('bar-grasa');

    if(resGrasa) resGrasa.textContent = fatPercentage.toFixed(1);
    if(resMasa) resMasa.textContent = leanMass.toFixed(1);
    if(resDef) resDef.textContent = Math.round(mantenimiento - 500).toString();
    if(resVol) resVol.textContent = Math.round(mantenimiento + 500).toString();
    if(barGrasa) barGrasa.style.width = `${Math.min(fatPercentage, 100)}%`;
  });
</script>