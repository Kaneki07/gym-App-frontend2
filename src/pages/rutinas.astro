---
import Layout from '../layouts/Layout.astro';

// Base de datos actualizada con referencias a GIFs
// Nota: Coloca tus archivos en public/gifs/ o usa URLs completas
const ejerciciosPorMusculo = {
  Pecho: [
    { n: "Press de Banca", g: "pressbanca.gif" },
    { n: "Aperturas con mancuernas", g: "apertura-con-mancuernas.gif" },
    { n: "Flexiones", g: "flexiones.gif" },
    { n: "Press inclinado", g: "pressinclinado.gif" }
  ],
  Espalda: [
    { n: "Dominadas", g: "dominadas.gif" },
    { n: "Remo con barra", g: "remoconbarra.gif" },
    { n: "Jal√≥n al pecho", g: "jalon-pecho.gif" },
    { n: "Peso muerto", g: "peso-muerto.gif" }
  ],
  Hombro: [
    { n: "Press Militar", g: "press-militar.gif" },
    { n: "Elevaciones laterales", g: "laterales.gif" },
    { n: "P√°jaros", g: "pajaros.gif" },
    { n: "Press Arnold", g: "press-arnold.gif" }
  ],
  B√≠ceps: [
    { n: "Curl de b√≠ceps con barra", g: "curl-biceps.gif" },
    { n: "Curl martillo", g: "curl-martillo.gif" },
    { n: "Curl concentrado", g: "curl-concentrado.gif" }
  ],
  Tr√≠ceps: [
    { n: "Extensiones en polea", g: "extensiones-triceps.gif" },
    { n: "Press franc√©s", g: "press-frances.gif" },
    { n: "Fondos de tr√≠ceps", g: "fondos.gif" }
  ],
  Cu√°driceps: [
    { n: "Sentadillas", g: "sentadilla.gif" },
    { n: "Prensa de piernas", g: "prensa.gif" },
    { n: "Extensiones", g: "extensioncuadriceps.gif" },
    { n: "Zancadas", g: "zancadas.gif" }
  ],
  Isquios: [
    { n: "Curl femoral", g: "curl-femoral.gif" },
    { n: "Peso muerto rumano", g: "pmr.gif" },
    { n: "Buenos d√≠as", g: "buenos-dias.gif" },
    { n: "Femoral Sentado", g: "femoralsentado.gif" }
  ],
  Pantorrillas: [
    { n: "Elevaci√≥n de talones sentado", g: "gemelos-sentado.gif" },
    { n: "Elevaci√≥n de talones de pie", g: "gemelos-pie.gif" },
    { n: "Elevaci√≥n de talones en prensa", g: "pantorrilla-sentado.gif" },
  ]
};

const musculos = Object.keys(ejerciciosPorMusculo);
---

<Layout title="Mis Rutinas | Gym App">
  <div id="exercise-modal" class="hidden fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/90 backdrop-blur-md">
    <div class="bg-black border border-red-600 rounded-[2.5rem] max-w-lg w-full overflow-hidden shadow-[0_0_50px_rgba(220,38,38,0.4)] relative">
        <button id="close-modal" class="absolute top-6 right-6 text-white/50 hover:text-red-600 z-50 font-black text-2xl transition-colors">‚úï</button>
        <div class="p-8">
            <div class="flex items-center gap-3 mb-6">
                <div class="h-6 w-1.5 bg-red-600 shadow-[0_0_10px_rgba(220,38,38,1)]"></div>
                <h2 id="modal-title" class="text-2xl font-black text-white uppercase italic tracking-tighter"></h2>
            </div>
            <div class="aspect-square bg-gray-900 rounded-3xl border border-white/5 overflow-hidden flex items-center justify-center">
                <img id="modal-gif" src="" alt="Cargando..." class="w-full h-full object-cover" />
            </div>
            <p class="text-center text-gray-500 text-[10px] font-black uppercase mt-6 tracking-widest italic">Protocolo de ejecuci√≥n t√©cnica</p>
        </div>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-6 py-12">
    <header class="mb-12 flex flex-col md:flex-row md:items-end justify-between gap-6">
      <div>
        <h1 class="text-4xl md:text-6xl font-black uppercase tracking-tighter text-white italic">
          √Årea de <span class="text-red-600 drop-shadow-[0_0_10px_rgba(220,38,38,0.5)]">Entrenamiento</span>
        </h1>
        <p class="text-gray-500 font-bold uppercase tracking-widest text-sm mt-2" id="current-view-label">
          Viendo: Rutina Semanal
        </p>
      </div>

      <div class="relative inline-block text-left">
        <button id="open-routine-menu" class="bg-gray-900/50 hover:bg-red-600 text-white px-6 py-4 rounded-2xl border border-red-600/30 text-[10px] font-black uppercase tracking-[0.2em] transition-all flex items-center gap-3 shadow-[0_10px_30px_rgba(0,0,0,0.5)] active:scale-95">
          ¬øQu√© deseas entrenar?
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7" /></svg>
        </button>

        <div id="routine-dropdown" class="hidden absolute right-0 mt-3 w-64 bg-black border border-red-600/30 rounded-[1.5rem] shadow-[0_20px_50px_rgba(0,0,0,0.8),0_0_20px_rgba(220,38,38,0.2)] z-50 overflow-hidden backdrop-blur-xl">
          <button class="view-option w-full text-left px-5 py-4 text-[10px] font-bold uppercase tracking-widest text-gray-400 hover:bg-red-600 hover:text-white transition-colors border-b border-gray-900" data-view="Semanal">üìÖ Rutina Semanal</button>
          <button class="view-option w-full text-left px-5 py-4 text-[10px] font-bold uppercase tracking-widest text-gray-400 hover:bg-red-600 hover:text-white transition-colors" data-view="Musculo">üí™ Rutina por M√∫sculo</button>
        </div>
      </div>
    </header>

    <div id="content-semanal" class="routine-section space-y-20">
      <section>
        <div class="flex flex-col md:flex-row md:items-end justify-between mb-8 border-b border-gray-900 pb-6 gap-4">
            <div>
                <span class="bg-red-600 text-white text-[10px] font-black px-4 py-1.5 rounded-full uppercase tracking-widest shadow-[0_0_15px_rgba(220,38,38,0.4)]">Opci√≥n 01</span>
                <h2 class="text-4xl font-black text-white uppercase italic tracking-tighter mt-4">Full Body <span class="text-gray-700">/ 2-3 D√≠as</span></h2>
            </div>
            <p class="text-gray-500 text-[10px] font-bold uppercase max-w-xs md:text-right leading-relaxed">M√°xima eficiencia. 1 d√≠a de descanso entre sesiones (Lunes, Mi√©rcoles, Viernes).</p>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <div class="lg:col-span-5 bg-gray-900/40 border border-red-600/20 p-8 rounded-[2.5rem] shadow-[0_20px_40px_rgba(0,0,0,0.4),0_0_15px_rgba(220,38,38,0.1)] hover:border-red-600/40 transition-all duration-500 group relative overflow-hidden">
                <div class="absolute -right-6 -bottom-6 text-9xl font-black text-white/[0.02] italic group-hover:text-red-600/[0.05] transition-colors pointer-events-none uppercase">FB</div>
                <h3 class="text-red-600 font-black text-xs uppercase tracking-[0.3em] mb-8 border-b border-red-600/20 pb-4">Estructura de Sesi√≥n</h3>
                <ul class="space-y-5 relative z-10">
                    {[["Piernas", "Sentadillas o Prensa"], ["Pecho", "Press de Banca"], ["Espalda", "Remo o Jal√≥n"], ["Hombros", "Press Militar"], ["Brazos", "B√≠ceps + Tr√≠ceps"], ["Core", "Plancha Abdominal"]].map(([label, value]) => (
                        <li class="flex justify-between items-center border-b border-gray-800/30 pb-2 group/item">
                            <span class="text-gray-500 text-[10px] font-black uppercase tracking-tighter group-hover/item:text-red-500 transition-colors">{label}</span>
                            <span class="text-white text-[11px] font-bold uppercase italic">{value}</span>
                        </li>
                    ))}
                </ul>
            </div>
        </div>
      </section>

      <section>
        <div class="mb-8 border-b border-gray-900 pb-6">
            <span class="bg-red-600 text-white text-[10px] font-black px-4 py-1.5 rounded-full uppercase tracking-widest shadow-[0_0_15px_rgba(220,38,38,0.4)]">Opci√≥n 02</span>
            <h2 class="text-4xl font-black text-white uppercase italic tracking-tighter mt-4">Torso Pierna <span class="text-gray-700">/ 4 D√≠as</span></h2>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
          {[
            { d: "Lunes", t: "Torso", e: "Fuerza", g: "Banca + Remo" },
            { d: "Martes", t: "Pierna", e: "Fuerza", g: "Sentadilla + PMR" },
            { d: "Jueves", t: "Torso", e: "Hiper", g: "Inclinado + Jal√≥n" },
            { d: "Viernes", t: "Pierna", e: "Hiper", g: "Prensa + Curl Fem" }
          ].map((item) => (
            <div class="bg-gray-900/30 border border-red-600/20 p-7 rounded-[2rem] shadow-[0_15px_35px_rgba(0,0,0,0.3),0_0_10px_rgba(220,38,38,0.05)] hover:border-red-600/50 hover:shadow-[0_20px_45px_rgba(0,0,0,0.5),0_0_20px_rgba(220,38,38,0.2)] transition-all duration-500 group">
                <div class="flex justify-between items-start mb-6">
                    <span class="text-gray-500 text-[10px] font-black uppercase tracking-widest">{item.d}</span>
                    <span class="text-red-600 text-[8px] font-black uppercase tracking-widest border border-red-600/40 px-2.5 py-1 rounded-lg bg-red-600/5">{item.e}</span>
                </div>
                <h4 class="text-white text-2xl font-black uppercase italic tracking-tighter group-hover:text-red-600 transition-colors">{item.t}</h4>
                <div class="mt-6 pt-6 border-t border-gray-800 text-gray-500 text-[10px] font-bold uppercase leading-relaxed group-hover:text-white transition-colors">{item.g}</div>
            </div>
          ))}
        </div>
      </section>

      <section>
        <div class="mb-8 border-b border-gray-900 pb-6">
            <span class="bg-red-600 text-white text-[10px] font-black px-4 py-1.5 rounded-full uppercase tracking-widest shadow-[0_0_15px_rgba(220,38,38,0.4)]">Opci√≥n 03</span>
            <h2 class="text-4xl font-black text-white uppercase italic tracking-tighter mt-4">Push Pull Legs <span class="text-gray-700">/ 6 D√≠as</span></h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          {[
            { t: "Push (Empuje)", d: "Lun + Jue", g: "Pecho, Hombros, Tr√≠ceps", id: "PUSH" },
            { t: "Pull (Tracci√≥n)", d: "Mar + Vie", g: "Espalda, B√≠ceps, Antebrazo", id: "PULL" },
            { t: "Legs (Pierna)", d: "Mi√© + S√°b", g: "Cu√°driceps, Isquios, Gemelos", id: "LEGS" }
          ].map((item) => (
            <div class="group bg-gray-900/40 border border-red-600/20 p-10 rounded-[2.5rem] shadow-[0_20px_40px_rgba(0,0,0,0.4),0_0_15px_rgba(220,38,38,0.15)] hover:border-red-600/60 hover:shadow-[0_25px_50px_rgba(0,0,0,0.6),0_0_25px_rgba(220,38,38,0.3)] transition-all duration-500 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 text-8xl font-black text-white/[0.03] italic group-hover:text-red-600/10 transition-colors pointer-events-none uppercase">{item.id}</div>
                <span class="text-red-600 font-black text-[11px] uppercase tracking-[0.3em] relative z-10">{item.d}</span>
                <h4 class="text-4xl font-black text-white uppercase italic mt-2 relative z-10 tracking-tighter">{item.t}</h4>
                <p class="text-gray-500 text-[11px] font-bold uppercase mt-8 relative z-10 leading-relaxed group-hover:text-gray-300">
                    Grupos musculares: <br/>
                    <span class="text-white group-hover:text-red-600 transition-colors text-xs mt-1 block font-black">{item.g}</span>
                </p>
            </div>
          ))}
        </div>
      </section>
    </div>

    <div id="content-musculo" class="routine-section hidden">
      <div class="relative mb-10">
        <div class="flex overflow-x-auto gap-3 pb-4 no-scrollbar snap-x">
          {musculos.map((m) => (
            <button class="musculo-btn flex-none snap-start bg-gray-900/50 border border-red-600/20 px-6 py-3 rounded-xl text-[10px] font-black uppercase text-gray-500 hover:border-red-600 hover:text-white hover:shadow-[0_0_15px_rgba(220,38,38,0.3)] transition-all whitespace-nowrap tracking-[0.1em]" data-musculo={m}>
              {m}
            </button>
          ))}
        </div>
        <div class="absolute right-0 top-0 h-full w-20 bg-gradient-to-l from-black to-transparent pointer-events-none"></div>
      </div>
      
      <div id="ejercicios-container" class="bg-gray-900/20 border border-red-600/10 rounded-[2.5rem] min-h-[300px] flex items-center justify-center relative overflow-hidden shadow-inner backdrop-blur-sm">
        <div id="placeholder-text" class="text-center">
            <p class="text-gray-700 font-black uppercase italic tracking-[0.3em] text-sm mb-2">Target Selection Required</p>
            <p class="text-gray-800 text-[10px] font-bold uppercase">Selecciona un grupo muscular para ver el arsenal</p>
        </div>
        <div id="lista-ejercicios" class="hidden w-full p-10 z-10">
            <div class="flex items-center gap-4 mb-10">
                <div class="h-8 w-2 bg-red-600 shadow-[0_0_10px_rgba(220,38,38,0.8)]"></div>
                <h2 id="musculo-titulo" class="text-3xl font-black text-white uppercase italic tracking-tighter"></h2>
            </div>
            <div id="ejercicios-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4"></div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<style>
  .no-scrollbar::-webkit-scrollbar { display: none; }
  .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
</style>

<script define:vars={{ ejerciciosPorMusculo }}>
  const modal = document.getElementById('exercise-modal');
  const modalTitle = document.getElementById('modal-title');
  const modalGif = document.getElementById('modal-gif');
  const closeModal = document.getElementById('close-modal');

  // L√≥gica para mostrar el ejercicio
  window.openExercise = (name, gif) => {
    modalTitle.textContent = name;
    modalGif.src = `/gifs/${gif}`; // Busca en public/gifs/
    modal.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  };

  closeModal?.addEventListener('click', () => {
    modal.classList.add('hidden');
    modalGif.src = '';
    document.body.style.overflow = 'auto';
  });

  // L√≥gica de navegaci√≥n original
  const menuBtn = document.getElementById('open-routine-menu');
  const dropdown = document.getElementById('routine-dropdown');
  const viewOptions = document.querySelectorAll('.view-option');
  const label = document.getElementById('current-view-label');
  const placeholder = document.getElementById('placeholder-text');
  
  const sections = {
    'Semanal': document.getElementById('content-semanal'),
    'Musculo': document.getElementById('content-musculo')
  };

  menuBtn?.addEventListener('click', (e) => {
    e.stopPropagation();
    dropdown?.classList.toggle('hidden');
  });

  document.addEventListener('click', () => dropdown?.classList.add('hidden'));

  viewOptions.forEach(opt => {
    opt.addEventListener('click', () => {
      const view = opt.dataset.view;
      label.textContent = `Viendo: Rutina ${view === 'Semanal' ? 'Semanal' : 'por M√∫sculo'}`;
      Object.keys(sections).forEach(key => {
        sections[key].classList.toggle('hidden', key !== view);
      });
    });
  });

  // L√≥gica de Renderizado de Ejercicios (Actualizada para GIFs)
  const musculoBtns = document.querySelectorAll('.musculo-btn');
  const listaCont = document.getElementById('lista-ejercicios');
  const titulo = document.getElementById('musculo-titulo');
  const grid = document.getElementById('ejercicios-grid');

  musculoBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const musculo = btn.dataset.musculo;
      const ejercicios = ejerciciosPorMusculo[musculo];
      
      placeholder?.classList.add('hidden');
      listaCont.classList.remove('hidden');
      titulo.textContent = musculo;
      
      grid.innerHTML = ejercicios.map(ej => `
        <button 
          onclick="openExercise('${ej.n}', '${ej.g}')"
          class="bg-black/60 border border-red-600/10 p-5 rounded-2xl flex items-center justify-between text-white text-[12px] font-black uppercase tracking-tight hover:border-red-600/60 hover:shadow-[0_0_15px_rgba(220,38,38,0.15)] transition-all group w-full text-left"
        >
            <div class="flex items-center gap-4">
                <span class="w-2 h-2 bg-red-600 rounded-full shadow-[0_0_8px_rgba(220,38,38,0.8)] group-hover:scale-125 transition-transform"></span>
                ${ej.n}
            </div>
            <span class="text-[8px] text-gray-700 group-hover:text-red-600 transition-colors italic">VER GIF</span>
        </button>
      `).join('');

      musculoBtns.forEach(b => b.classList.remove('border-red-600', 'text-white', 'shadow-[0_0_15px_rgba(220,38,38,0.3)]'));
      btn.classList.add('border-red-600', 'text-white', 'shadow-[0_0_15px_rgba(220,38,38,0.3)]');
    });
  });

  if (!localStorage.getItem('token')) window.location.href = '/login';
</script>